name: Fetch Logs

on:
  push:
    tags:
      - "[0-9]+.[0-9]+.[0-9]+"
      - "[0-9]+.[0-9]+.[0-9]+.post[0-9]+"
      - "[0-9]+.[0-9]+.[0-9]+[a-b][0-9]+"
      - "[0-9]+.[0-9]+.[0-9]+rc[0-9]+"

permissions:
  contents: read

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - run: |
          set -ex
          while [ ! -f metadata.txt ]
          do 
            sleep 1
            gh release download ${{ github.ref_name }} || true
          end
          cat metadata.txt

      - name: Get Job ID from GH API
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          job=$(cat metadata.txt)
          gh run view --log --job=$job